package JuegoVida;

import java.util.*;

public class Main {

	public static void main(String[] args) {
		// TODO Auto-generated method stub
		//Creamos arraylist de Tripleta
		ArrayList <Tripleta> datos = new ArrayList <Tripleta>();
		//preguntamos filas y columnas y las generaciones.
		int filas = comprobarEntrada("filas");
		int columnas = comprobarEntrada("columnas");
		int numGeneraciones = comprobarEntrada("generaciones");
		

		//Crear tablero donde se irán almacenando.
		String [][] tablero = new String[filas][columnas];      //Si introduce fila 0 y columna 0 da ERROR.			
		//rellenar tablero con células.
		rellenar(tablero);
		//Empieza el desarrollo del programa.
		int veces = 0;
		int celActual = 0;
		while(veces <= numGeneraciones) {
			celActual = contarCel(tablero);
			Tripleta celda = new Tripleta();
			//Ir rellenando la tripleta
			if(veces == 0) { //Caso inicial
				celda.setNumCelVivas(celActual); 
				celda.setNumCelNuevas(celActual);
				datos.add(celda);
			}
			else { //Resto de casos
				celda.setNumCelVivas(celActual);
				celda.setNumCelNuevas(celActual - (datos.get(datos.size()-1).getNumCelVivas()));
				datos.add(celda);
			}
			//Imprimir información
			System.out.println("GENERACIÓN: " + veces);
//			System.out.println("HAY UN TOTAL DE: " + datos.get(veces).getNumCelVivas() + " CELULAS VIVAS");
//			if(veces > 0) {
//				System.out.println("VIVAS RESPECTO A LA ANTERIOR GENERACIÓN: " + datos.get(veces).getNumCelNuevas());
//			}
			//visualizar el tablero inicial
			visualizar(tablero);
			System.out.println();
			//Aplica metodos de crear o no una celula mientras no llegue al último bucle.
			if(veces != numGeneraciones) {
				//Método para vivir o morir.
				supervivencia(tablero);
			}
			if(celActual == 0) { //Si No hay celulas vivas, se extingue la colonia
				System.out.println("COLONIA EXTINGUIDA");
				break;
			}
			veces++;
		}
		//Si ha llegado al máximo de generaciones, dice cuantas quedan vivas.
		if(veces == numGeneraciones + 1) {
			System.out.println("Quedan " + celActual + " vivas.");
		}
		System.out.println();
		System.out.println("----------------------------RESUMEN-------------------------------");
		System.out.printf("%-15s %-20s %-15s %n", "Generación", "Celulas vivas", "Celulas respecto al anterior");
		System.out.println("------------------------------------------------------------------");
		for (Tripleta i:datos) {
			System.out.printf("%-3d| %20d| %20d| %n", i.getGeneracion(), i.getNumCelVivas(), i.getNumCelNuevas());
		}
		
		
	}
	
	
//	public static int comprobarEntrada(String pregunta) {
//		Scanner entrada = new Scanner (System.in);
//		int num;
//			try {
//				System.out.println("Introduce el número de " + pregunta);
//				num = entrada.nextInt();
//				if(num < 0) {
//					System.out.println("error");
//				}
//				return num;
//			}catch (InputMismatchException e) {
//				System.out.println("error");
//				return -9999;
//			}
//	}
//	
	public static int comprobarEntrada(String pregunta) {
		int num = 0;
		boolean correcto = false;
		do {
			try {
				Scanner entrada = new Scanner (System.in);
				System.out.println("Introduce el número de " + pregunta);
				num = entrada.nextInt();
				if(num < 0) {
					System.out.println("error");
					correcto = false;
				}
				else{
					correcto = true;
				}
			}catch (InputMismatchException e) {
				System.out.println("error");
				correcto = false;
			}
		}while(!correcto);
		return num;
	}
	
	
	/**
	 * Método para visualizar el tablero.
	 * @param tabla
	 */
	public static void visualizar(String[][] tabla) {
		for (int i = 0; i < tabla.length; i++) {
			System.out.print("|");
			for(int j = 0; j < tabla[i].length; j++) {
				System.out.print(tabla[i][j]+"|");
			}
			System.out.println();
		}
	}
	
	/**
	 * Método para rellenar aleatoriamente el tablero de células.
	 * @param tabla
	 */
	public static void rellenar(String [][] tabla) {
		//Recorre la tabla y la llenará aleatoriamente.
		int random;
		for (int i = 0; i < tabla.length; i++) {
			for(int j = 0; j < tabla[i].length; j++) {
				random =  (int) (Math.random() * 10);
				//System.out.println(random);
				if(random <= 1 ) {
					tabla[i][j] = "*";
				}
				else {
					tabla[i][j] = " ";
				}
			}
		}
		
	}
	
	/**
	 * Método que cuenta las celulas vivas en ese momento.
	 * @param tabla
	 * @return
	 */
	public static int contarCel(String [][] tabla) {
		int contador = 0;
		for (int i = 0; i < tabla.length; i++) {
			for(int j = 0; j < tabla[i].length; j++) {
				if(tabla[i][j].equals("*")) {
					contador++;
				}
			}
		}
		return contador;
	}
	
	
	
	
	public static void supervivencia(String [][] tabla) {
		boolean estado = false; //Si esta viva o muerta
		int count = 0; //Contador de celulas de alrededor
		//Tabla Auxiliar donde se irán recogiendo los resultados de una generación.
		String [][] tablaAux = new String[tabla.length][tabla[0].length];
		for (int i = 0; i < tabla.length; i++) {
			for(int j = 0; j < tabla[i].length; j++) {
				if(tabla[i][j].equals("*")) {
					estado = true;
					count--; //Le resta uno al contador ya que en la comprobación posterior se contará a ella misma.
				}
				else {
					estado = false;
				}
				//Recorre alrededor buscando las celulas vivas.
				for (int fila = i - 1; fila < i + 2; fila++) {
					for (int columna = j - 1; columna < j + 2; columna++) {
						if (validacionCelda(tabla, fila, columna)) {
							if (tabla[fila][columna].equals("*")) {
								count++;
							}	
						}
					}
				}
			    //Si está muerta y tiene 3 vivas alrededor revivira.
				if (!estado && count == 3) {
					//RESUCITAR.
					tablaAux[i][j] = "*";
				}
				//si está viva y tiene 2 o 3 vivas sigue viva,
				else if(estado && (count == 2 || count == 3)){
					//SOBREVIVE.
					tablaAux[i][j] = "*";
				}
				//de lo contrario en todos los otros casos muere.
				else {
					//ESTARÁ MUERTA.
					tablaAux[i][j] = " ";
				}
				count = 0;
			}
		}
		//Copiar la tabla AUX en la tabla PRINCIPAL para el cambio de generación.
		for (int i = 0; i < tabla.length; i++) {
			for(int j = 0; j < tabla[i].length; j++) {
				tabla[i][j] = tablaAux[i][j];
			}
		}
	}
	
	
	public static boolean validacionCelda(String[][] tabla, int i, int j) {
		if(i < 0 || i >= tabla.length || j >= tabla[0].length || j < 0) {
			return false;
		}
		else {
			return true;
		}
	}

}
